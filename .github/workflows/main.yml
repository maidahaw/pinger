name: Unlimited Fair Share Views
on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *'

jobs:
  browser-views:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - name: Install Browser
        run: |
          pip install playwright
          playwright install chromium
      - name: Round-Robin Views
        run: |
          python - <<EOF
          import time
          from playwright.sync_api import sync_playwright

          def run_views():
              with sync_playwright() as p:
                  browser = p.chromium.launch(headless=True)
                  context = browser.new_context(user_agent="Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X)")
                  page = context.new_page()
                  
                  with open('links.txt', 'r') as f:
                      links = [line.strip() for line in f if line.strip()]
                  
                  if not links: 
                      print("No links found in links.txt", flush=True)
                      return

                  # Target 1,500 total per link, in small batches of 20 for fast rotation
                  batch_size = 20
                  total_target = 1500
                  rounds = total_target // batch_size

                  for r in range(rounds):
                      for url in links:
                          print(f"--- Round {r+1}: Batch of {batch_size} for {url} ---", flush=True)
                          for i in range(1, batch_size + 1):
                              try:
                                  page.goto(url, wait_until="commit", timeout=60000)
                                  time.sleep(4) # Your requested 4-second delay
                              except Exception:
                                  continue
                  browser.close()

          run_views()
          EOF
