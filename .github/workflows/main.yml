name: Fixed 1500 Views Per Link
on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *'

jobs:
  browser-views:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - name: Install Browser
        run: |
          pip install playwright
          playwright install chromium
      - name: Fast Human Views
        run: |
          python - <<EOF
          import time
          from playwright.sync_api import sync_playwright

          def run_views():
              with sync_playwright() as p:
                  browser = p.chromium.launch(headless=True)
                  context = browser.new_context(user_agent="Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15")
                  page = context.new_page()
                  
                  with open('links.txt', 'r') as f:
                      links = f.readlines()
                  
                  # This part ensures EVERY link in your file gets its own 1500 views
                  for url in links:
                      url = url.strip()
                      if not url: continue
                      print(f"--- Starting 1,500 views for {url} ---", flush=True)
                      for i in range(1, 1501):
                          try:
                              page.goto(url, wait_until="commit", timeout=60000)
                              # Set to 4 seconds as requested
                              time.sleep(4) 
                              if i % 50 == 0: 
                                  print(f"Sent {i}/1500 views to {url}", flush=True)
                          except Exception:
                              continue
                  browser.close()

          run_views()
          EOF
      - name: Clear Links
        run: |
          > links.txt
          git config --global user.name "CloudBot"
          git config --global user.email "bot@github.com"
          git add links.txt
          git commit -m "Links cleared" || echo "No changes"
          git push
