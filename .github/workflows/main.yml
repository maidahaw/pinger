name: Optimized Daily Views
on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *' # Runs once daily at 12:00 PM UTC

jobs:
  refresh:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - name: Process All Links
        run: |
          # Check if the file is empty first to save cloud minutes
          if [ ! -s links.txt ]; then
            echo "links.txt is empty. Skipping run."
            exit 0
          fi

          while read -r url; do
            echo "Processing 3,000 views for $url"
            for i in {1..3000}; do
              curl -s -L -A "Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X)" "$url" > /dev/null
              sleep 0.4
            done
          done < links.txt

          # Clear the file after successful completion
          > links.txt
          
      - name: Save Changes
        run: |
          git config --global user.name "CloudBot"
          git config --global user.email "bot@github.com"
          git add links.txt
          git commit -m "Cleared processed links" || echo "No changes to commit"
          git push
